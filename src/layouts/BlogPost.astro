---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import HeaderBlog from "../components/HeaderBlog.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import RelatedPosts from "../components/RelatedPosts.astro";
import PopularPosts from "../components/PopularPosts.astro";
import SosialShareButtons from "../components/SosialShareButtons.astro";

type Props = CollectionEntry<"blog">["data"] & {
  slug: string;
};

const currentUrl = new URL(Astro.url.pathname, Astro.site);
const { title, description, pubDate, updatedDate, heroImage, category, status } = Astro.props;
import { ClientRouter } from "astro:transitions";

const categories = Array.isArray(category) ? category : [category];
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />

    <!-- Schema.org Breadcrumb -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "name": "Posts", "item": "${Astro.site}post" },
          { "@type": "ListItem", "position": 2, "name": "${categories[0]}", "item": "${Astro.site}posts/category/${categories[0].toLowerCase()}" },
          { "@type": "ListItem", "position": 3, "name": "${title}", "item": "${currentUrl}" }
        ]
      }
    </script>

    <style>
      /* Smooth rendering */
      * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
      a { text-underline-offset: 3px; text-decoration-thickness: .08em; }

      /* ============ Layout Container ============ */
      .blog-layout {
        --sidebar-w: min(280px, 28vw);
        max-width: 1080px;
        margin: 0 auto;
        padding: 1.5rem 1rem;
        display: grid;
        grid-template-columns: minmax(0, 1fr) var(--sidebar-w);
        gap: 2.5rem;
        align-items: start;
      }

      .blog-content-wrapper { 
        min-width: 0; 
        max-width: 720px;
      }

      /* ============ Breadcrumb ============ */
      .blog-breadcrumb {
        display: flex;
        align-items: center;
        gap: .5rem;
        margin-bottom: 1.25rem;
        flex-wrap: wrap;
      }

      .blog-breadcrumb a {
        padding: .28rem .7rem;
        border-radius: 999px;
        font-size: 0.78rem;
        font-weight: 700;
        background-color: var(--bg-tags);
        color: var(--text-color);
        text-decoration: none;
        transition: background-color .2s ease;
        opacity: .85;
      }
      .blog-breadcrumb a:hover { opacity: 1; }
      .blog-breadcrumb .separator { color: var(--text-color); opacity: .4; margin: 0 .3rem; }

      /* ============ Header Artikel ============ */
      .article-header { margin-bottom: 1.25rem; }

      .article-title {
        font-size: clamp(1.45rem, 2.6vw, 1.8rem);
        line-height: 1.25;
        margin-bottom: .6rem;
        color: var(--text-color);
        font-weight: 800;
        letter-spacing: -0.02em;
      }

      .article-description {
        font-size: clamp(0.98rem, 1.7vw, 1.08rem);
        color: var(--text-color);
        opacity: .85;
        line-height: 1.6;
        margin-bottom: 1rem;
      }

      .article-meta {
        display: flex;
        align-items: center;
        gap: .9rem;
        padding: .85rem 0;
        border-top: 1px solid var(--bg-tags);
        border-bottom: 1px solid var(--bg-tags);
      }

      .author-avatar {
        width: 42px; 
        height: 42px;
        border-radius: 50%;
        overflow: hidden;
        background-color: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        border: 2px solid #000;
        
      }
      .author-avatar img { 
        width: 100%; 
        height: 100%; 
        object-fit: contain;
      }

      .author-details { flex: 1; min-width: 0; }
      .author-name { 
        display: block; 
        font-weight: 800; 
        color: var(--text-color); 
        font-size: 0.93rem; 
        margin-bottom: .15rem; 
      }
      .author-role { 
        display: block; 
        font-size: 0.78rem; 
        color: var(--text-color); 
        opacity: .65; 
        margin-bottom: .1rem; 
      }
      .article-date { 
        font-size: 0.78rem; 
        color: var(--text-color); 
        opacity: .55; 
      }

      /* ============ Hero Image ============ */
      .article-hero-image {
        margin: 1.2rem 0 1rem;
        border-radius: 8px;
        overflow: hidden;
      }
      .article-hero-image img { width: 100%; height: auto; display: block; }

      /* ============ Body ============ */
      .article-body { margin: 1.1rem 0; }

      .prose :where(p){ 
        font-size: 0.98rem; 
        line-height: 1.72; 
        margin: .9rem 0; 
      }
      .prose :where(h2){ 
        font-size: clamp(1.2rem, 2.2vw, 1.4rem); 
        margin: 1.6rem 0 .65rem; 
        line-height: 1.3; 
        font-weight: 800;
      }
      .prose :where(h3){ 
        font-size: clamp(1.06rem, 1.9vw, 1.2rem); 
        margin: 1.2rem 0 .55rem; 
        line-height: 1.3; 
        font-weight: 800;
      }
      .prose :where(ul,ol){ padding-left: 1.35rem; margin: .9rem 0; }
      .prose :where(li){ margin: .35rem 0; }
      .prose :where(blockquote){
        margin: 1.2rem 0; 
        padding: .9rem 1.1rem;
        border-left: 3px solid var(--primary); 
        background: color-mix(in oklab, var(--bg-tags) 50%, transparent);
        border-radius: 6px;
        font-size: 0.98rem;
      }
      .prose :where(code){ 
        font-size: .9em; 
        padding: .12rem .36rem; 
        border-radius: 4px; 
        background: color-mix(in oklab, var(--bg-tags) 60%, transparent); 
      }

      /* ============ Tags ============ */
      .article-tags {
        display: flex; 
        flex-wrap: wrap; 
        gap: .45rem; 
        margin: 1rem 0 .9rem;
      }
      .article-tag {
        padding: .35rem .75rem;
        border-radius: 999px;
        font-size: 0.78rem;
        font-weight: 700;
        background-color: var(--bg-tags);
        transition: background-color .2s ease;
      }
      .article-tag a { 
        color: var(--text-color); 
        text-decoration: none; 
        opacity: .85; 
      }
      .article-tag:hover a { opacity: 1; }

      .article-divider {
        border: none; 
        border-top: 1px solid var(--bg-tags);
        margin: 1.1rem 0; 
        opacity: .5;
      }

      /* ============ Sidebar - Compact & Sticky ============ */
      .blog-sidebar { 
        position: sticky; 
        top: 110px;
        height: fit-content;
        max-height: calc(100vh - 96px);
        overflow-y: auto;
        overflow-x: hidden;
        
       
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE dan Edge */
      }

      
      .blog-sidebar::-webkit-scrollbar {
        display: none;
      }

      /* Follow Us / Subscribe Section */
      .subscribe-section {
        text-align: center;
        background: linear-gradient(135deg, #4A90E2 0%, #3298ff 100%) !important;
        border-color: #4A90E2 !important;
        padding: 1.2rem;
      }
      .subscribe-section .sidebar-title { 
        color: #ffffff; 
        font-size: 0.88rem;
        font-weight: 900;
        margin-bottom: .75rem;
        letter-spacing: -0.01em;
      }
      .subscribe-description {
        font-size: 0.82rem;
        color: #ffffff;
        opacity: .92;
        margin-bottom: .8rem;
        line-height: 1.4;
      }
      .social-links {
        display: flex;
        justify-content: center;
        gap: .65rem;
      }
      .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.16);
        color: #ffffff;
        text-decoration: none;
        transition: all .2s ease;
        backdrop-filter: blur(10px);
      }
      .social-link:hover {
        background-color: rgba(255, 255, 255, 0.26);
        transform: translateY(-1px);
      }
      .social-link svg { 
        width: 18px; 
        height: 18px; 
      }

      /* ============ Responsive ============ */
      @media (max-width: 1024px) {
        .blog-layout {
          grid-template-columns: 1fr;
          gap: 1.5rem;
          padding: 1.25rem 1rem;
        }
        
        .blog-content-wrapper {
          max-width: 100%;
        }
        
        .blog-sidebar {
          position: static;
          max-height: none;
          overflow: visible;
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
          gap: 1rem;
        }
      }

      @media (max-width: 768px) {
        .article-title { font-size: clamp(1.35rem, 5vw, 1.65rem); }
        .article-description { font-size: .98rem; }
        .blog-sidebar { 
          grid-template-columns: 1fr; 
        }
        .article-meta { gap: .75rem; padding: .8rem 0; }
        .author-avatar { width: 38px; height: 38px; }
      }

      @media (max-width: 480px) {
        .blog-layout { 
          padding: 1rem .75rem; 
        }
        .article-description { font-size: 0.95rem; }
        .prose :where(p){ font-size: 0.95rem; }
        .social-links { 
          justify-content: center; 
        }
      }
    </style>
  </head>

  <body>
    <ClientRouter />
    <HeaderBlog />

    <main>
      <div class="blog-layout">
        <!-- Main Content -->
        <div class="blog-content-wrapper">
          <article class="blog">
            <!-- Breadcrumb -->
            <nav class="blog-breadcrumb" aria-label="Breadcrumb">
              <a href="/posts">Articles</a>
              <span class="separator">›</span>
              {categories.map((cat, index) => (
                <>
                  <a href={`/posts/category/${cat.toLowerCase()}`}>{cat}</a>
                  {index < categories.length - 1 && <span class="separator">›</span>}
                </>
              ))}
            </nav>

            <!-- Article Header -->
            <header class="article-header">
              <h1 class="article-title">{title}</h1>
              <p class="article-description">{description}</p>

              <!-- Author Meta -->
              <div class="article-meta">
                <div class="author-avatar">
                  <img
                    src="/assets/img/qualita_indonesia_logo.png"
                    alt="Qualita Indonesia"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
                <div class="author-details">
                  <span class="author-name">Admin Qualita</span>
                  <span class="author-role">News, Event & Career</span>
                  <span class="article-date">
                    Update on <FormattedDate date={pubDate} />
                    {updatedDate && (
                      <span> · Last updated <FormattedDate date={updatedDate} /></span>
                    )}
                  </span>
                </div>
              </div>
            </header>

            <!-- Hero Image -->
            {heroImage && (
              <div class="article-hero-image">
                <img width={1020} height={510} src={heroImage} alt={title} loading="lazy" decoding="async" />
              </div>
            )}

            <!-- Article Body -->
            <div class="prose article-body">
              <slot />
            </div>

            <!-- Tags -->
            <div class="article-tags">
              {categories.map((cat) => (
                <span class="article-tag">
                  <a href={`/posts/category/${cat.toLowerCase()}`}>{cat}</a>
                </span>
              ))}
            </div>

            <hr class="article-divider" />

            <!-- Social Share -->
            <SosialShareButtons title={title} description={description} />

            <!-- Related Posts -->
            <RelatedPosts category={category} />
          </article>
        </div>

        <!-- Sidebar - Compact & Clean -->
        <aside class="blog-sidebar">
          <!-- Popular Posts (menggunakan komponen baru) -->
          <PopularPosts category={category} limit={5} />

          <!-- Follow Us -->
          <div class="subscribe-section">
            <h3 class="sidebar-title">Follow Us / Ikuti Kami</h3>
            <p class="subscribe-description">
              Get our latest updates / Dapatkan update terbaru dari kami
            </p>
            <div class="social-links">
              <a href="https://www.linkedin.com/company/qualita-indonesia/" class="social-link" aria-label="LinkedIn" target="_blank" rel="noopener noreferrer">
                <svg fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"/>
                  <circle cx="4" cy="4" r="2"/>
                </svg>
              </a>
              <a href="https://www.facebook.com/PTQualitaIndonesia" class="social-link" aria-label="Facebook" target="_blank" rel="noopener noreferrer">
                <svg fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 2C6.477 2 2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.879V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.989C18.343 21.129 22 16.99 22 12c0-5.523-4.477-10-10-10z"/>
                </svg>
              </a>
              <a href="https://www.instagram.com/qualita.indonesia/" class="social-link" aria-label="Instagram" target="_blank" rel="noopener noreferrer">
                <svg fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 2c2.717 0 3.056.01 4.122.06 1.065.05 1.79.217 2.428.465.66.254 1.216.598 1.772 1.153a4.908 4.908 0 0 1 1.153 1.772c.247.637.415 1.363.465 2.428.047 1.066.06 1.405.06 4.122 0 2.717-.01 3.056-.06 4.122-.05 1.065-.218 1.79-.465 2.428a4.883 4.883 0 0 1-1.153 1.772 4.915 4.915 0 0 1-1.772 1.153c-.637.247-1.363.415-2.428.465-1.066.047-1.405.06-4.122.06-2.717 0-3.056-.01-4.122-.06-1.065-.05-1.79-.218-2.428-.465a4.89 4.89 0 0 1-1.772-1.153 4.904 4.904 0 0 1-1.153-1.772c-.248-.637-.415-1.363-.465-2.428C2.013 15.056 2 14.717 2 12c0-2.717.01-3.056.06-4.122.05-1.066.217-1.79.465-2.428a4.88 4.88 0 0 1 1.153-1.772A4.897 4.897 0 0 1 5.45 2.525c.638-.248 1.362-.415 2.428-.465C8.944 2.013 9.283 2 12 2zm0 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm6.5-.25a1.25 1.25 0 1 0-2.5 0 1.25 1.25 0 0 0 2.5 0zM12 9a3 3 0 1 1 0 6 3 3 0 0 1 0-6z"/>
                </svg>
              </a>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <Footer />
  </body>
</html>